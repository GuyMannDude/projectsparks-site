(function(global) {
    'use strict';
    
    function ChatboxEditor(options) {
        this.options = Object.assign({
            container: '#chatbox-editor',
            placeholder: 'Type your message...',
            maxLength: 1000
        }, options);
        
        this.container = typeof this.options.container === 'string' 
            ? document.querySelector(this.options.container)
            : this.options.container;
            
        this.init();
    }
    
    ChatboxEditor.prototype.init = function() {
        if (!this.container) {
            console.error('ChatboxEditor: Container not found');
            return;
        }
        
        this.createEditor();
        this.bindEvents();
    };
    
    ChatboxEditor.prototype.createEditor = function() {
        this.container.innerHTML = `
            <div class="chatbox-editor">
                <div class="chatbox-editor-toolbar">
                    <button class="chatbox-editor-button" data-action="bold">B</button>
                    <button class="chatbox-editor-button" data-action="italic">I</button>
                    <button class="chatbox-editor-button" data-action="clear">Clear</button>
                </div>
                <textarea class="chatbox-editor-input" placeholder="${this.options.placeholder}" maxlength="${this.options.maxLength}"></textarea>
            </div>
        `;
        
        this.input = this.container.querySelector('.chatbox-editor-input');
    };
    
    ChatboxEditor.prototype.bindEvents = function() {
        const toolbar = this.container.querySelector('.chatbox-editor-toolbar');
        const self = this;
        
        toolbar.addEventListener('click', function(e) {
            if (e.target.classList.contains('chatbox-editor-button')) {
                const action = e.target.getAttribute('data-action');
                self.handleAction(action);
            }
        });
    };
    
    ChatboxEditor.prototype.handleAction = function(action) {
        switch(action) {
            case 'clear':
                this.input.value = '';
                break;
            case 'bold':
                this.wrapSelection('**', '**');
                break;
            case 'italic':
                this.wrapSelection('*', '*');
                break;
        }
    };
    
    ChatboxEditor.prototype.wrapSelection = function(before, after) {
        const start = this.input.selectionStart;
        const end = this.input.selectionEnd;
        const text = this.input.value;
        const selectedText = text.substring(start, end);
        
        this.input.value = text.substring(0, start) + before + selectedText + after + text.substring(end);
        this.input.focus();
        this.input.setSelectionRange(start + before.length, end + before.length);
    };
    
    ChatboxEditor.prototype.getValue = function() {
        return this.input.value;
    };
    
    ChatboxEditor.prototype.setValue = function(value) {
        this.input.value = value;
    };
    
    global.ChatboxEditor = ChatboxEditor;
    
})(typeof window !== 'undefined' ? window : this);
